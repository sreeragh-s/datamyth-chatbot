<!DOCTYPE html>
<html>
    <head>
        <title>Chat Page</title>
    </head>
    <body style="background-color: white;">
    <script>
        const integrationData = [
            {
                "_id": "66ead7bbc0c7dbdbfdbef364",
                "account_id": "7733603372",
                "account_name": "Blockware",
                "alert_user": false,
                "channel_id": "605b35cb1b82c9d919b572e0",
                "client_id": "66ead7aadbb1c41c894236aa",
                "eCommerceTracking": false,
                "fetchable": true,
                "last_update_date": "2024-09-18T13:38:03.238754",
                "link_date": "2024-09-18T13:38:03.238743",
                "login_customer_id": 7733603372,
                "property_name": null,
                "status": "Active",
                "template_name": "Paid Campaign Performance (Google Ads)",
                "type": "Google Ads",
                "user_id": "6045c14bfdc78e610f6f47c8"
            },
            {
                "_id": "670cd636c0c7dbdbfdbef393",
                "account_id": "371901598",
                "account_name": "Blockware Marketplace",
                "alert_user": false,
                "channel_id": "61cd6644714a91c5fddd500b",
                "client_id": "66ead7aadbb1c41c894236aa",
                "eCommerceTracking": false,
                "fetchable": true,
                "last_update_date": "2024-10-14T08:28:38.226486",
                "link_date": "2024-10-14T08:28:38.226474",
                "login_customer_id": null,
                "property_name": "Blockware Marketplace",
                "status": "Active",
                "template_name": "Website Traffic Performance (GA4)",
                "type": "GA4",
                "user_id": "6045c14bfdc78e610f6f47c8"
            },
            {
                "_id": "6745897b03efccccba2b0597",
                "account_id": "350414741653938",
                "account_name": "Suhas MV",
                "alert_user": false,
                "channel_id": "6261844e590a2bfa44a8e06b",
                "client_id": "66ead7aadbb1c41c894236aa",
                "eCommerceTracking": false,
                "fetchable": true,
                "last_update_date": "2024-11-26T08:40:27.720711",
                "link_date": "2024-11-26T08:40:27.720699",
                "login_customer_id": null,
                "property_name": null,
                "status": "Active",
                "template_name": "Paid Social Performance (Facebook Ads)",
                "type": "Facebook Ads",
                "user_id": "6045c14bfdc78e610f6f47c8"
            },
            {
                "_id": "678fd4e2c27dd139792eec06",
                "account_id": "https://www.datamyth.com/",
                "account_name": null,
                "alert_user": false,
                "channel_id": "62610214590a2bfa44796826",
                "client_id": "66ead7aadbb1c41c894236aa",
                "eCommerceTracking": false,
                "fetchable": true,
                "last_update_date": "2025-01-21T17:09:54.393555",
                "link_date": "2025-01-21T17:09:54.393543",
                "login_customer_id": null,
                "property_name": null,
                "status": "Active",
                "template_name": "Website SERP Performance (Google Search Console)",
                "type": "Google Search Console",
                "user_id": "6045c14bfdc78e610f6f47c8"
            },
            {
                "_id": "678fd4e2c27dd139792eec06",
                "client_id": "66ead7aadbb1c41c894236aa",
                "fetchable": true,
                "ga4_account_id": "371901598",
                "ga4_account_name": "Blockware Marketplace",
                "ga4_channel_id": "61cd6644714a91c5fddd500b",
                "ga4_property_name": "Blockware Marketplace",
                "gsc_account_id": "https://www.datamyth.com/",
                "gsc_account_name": null,
                "gsc_channel_id": "62610214590a2bfa44796826",
                "gsc_property_name": null,
                "template_name": "Organic Search Performance (GA4 + GSC)",
                "type": "GA4 + GSC"
            },
            {
                "_id": "66ead7bbc0c7dbdbfdbef364",
                "client_id": "66ead7aadbb1c41c894236aa",
                "facebook_account_id": "350414741653938",
                "facebook_account_name": "Suhas MV",
                "facebook_channel_id": "6261844e590a2bfa44a8e06b",
                "facebook_property_name": null,
                "fetchable": true,
                "gads_account_id": "7733603372",
                "gads_account_name": "Blockware",
                "gads_channel_id": "605b35cb1b82c9d919b572e0",
                "gads_login_customer_id": 7733603372,
                "gads_property_name": null,
                "template_name": "Paid Marketing Performance (FB + Google Ads)",
                "type": "FB + Google Ads"
            }
        ];

        localStorage.setItem('integrationData', JSON.stringify(integrationData));

        const iframe = document.createElement("iframe");
        iframe.src = "http://localhost:3001/chat-page"; 
        iframe.style.border = "none";
        iframe.width = "100%";
        iframe.height = "100%";
        iframe.style.position = "fixed";
        document.body.appendChild(iframe);

        iframe.onerror = (error) => {
            console.error("Error loading iframe:", error);
        };

        iframe.onload = () => {
            // Wait for FRAME_READY message before sending data
            window.addEventListener("message", function frameReadyHandler(event) {
                if (event.data?.type === "FRAME_READY") {
                    console.log("Frame ready, sending data...");
                    
                    const messageData = {
                        type: "INTEGRATION_DATA",
                        integrationData: integrationData
                    };
                    
                    // Use * for initial testing, then lock down to specific origin
                    iframe.contentWindow.postMessage(messageData, "*");
                    console.log("Message sent to iframe");
                    
                    // Remove this listener since we only need it once
                    window.removeEventListener("message", frameReadyHandler);
                }
            });

            // Add this before the main message sending
            iframe.contentWindow.postMessage({ type: "TEST_MESSAGE", text: "Hello frame!" }, "*");
        };
    </script>
    </body>
</html>

